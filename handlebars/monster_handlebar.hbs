{{!-- This handlebar is a modified version of one from Josh P.  It will handle Monsters exported from Foundry.  It relies on two modules, PF2E Exporter and More Handlebars Helpers. --}}
{{!-- me-debugDumpObject "Monster JSON" --}}
---
title: "{{{name}}}"
obsidianUIMode: preview
noteType: pf2eMonster
cssClasses:
  - pf2e
aliases:
  - "{{{uuid}}}" 
tags:
{{#each system.traits.value}}
  - pf2e/creature/type/{{this}}
{{/each}}
  - pf2eMonster
  - pf2e/creature/level/{{system.details.level.value}}
{{#if system.details.publication.remaster}}
  - remaster
{{/if~}}
statblock: inline
name: "{{name}}"
level: {{system.details.level.value}}
license: {{{system.details.publication.license}}}
---

```statblock
layout: Pathfinder 2e Creature Layout
{{#if this.img_path}}
token: {{this.img_path}}
{{/if}}
sourcebook: "{{system.details.publication.title}}"
name: "{{{name}}}"
level: Creature {{system.details.level.value}}
rarity: [[{{system.traits.rarity}}]]
{{#with system.details.alignment.value as |alignment|}}
alignment: {{more-handlebars-helpers-table alignment "LG" "Lawful Good" "LN" "Lawful Neutral" "LE" "Lawful Evil" "NG" "Neutral Good" "N" "Neutral" "NE" "Neutral Evil" "CG" "Chaotic Good" "CN" "Chaotic Neutral" "CE" "Chaotic Evil"}}
{{/with}}
size: {{more-handlebars-helpers-table system.traits.size.value "ti" "Tiny" "sm" "Small" "med" "Medium" "lg" "Large" "hu" "Huge" "ga" "Gargantuan" "grg" "Gargantuan"}}
{{#if system.traits.value}}
traits:
{{#each system.traits.value as |trait|}}
  - [[{{trait}}]]
{{/each}} 
{{/if}}

modifier: {{system.perception.value}}
{{#with system.perception.senses as |senses|}}
senses: {{#each senses}}{{label}}{{ifThen @last "" ", "}}{{/each}}
{{/with}}
{{#if (or system.details.languages.value system.details.languages.details)}}
languages: "{{#each system.details.languages.value as |language|}}{{{capitalize language}}}{{ifThen @last "" ", "}}{{/each}}{{#if system.details.languages.details}}{{ifThen system.details.languages.value "; " ""}}{{{system.details.languages.details}}}{{/if}}"
{{/if}}
{{#with (me-skillList system.skills) as |skills|}}
skills:
{{#each skills}}
  - "{{{label}}}": {{totalModifier}}{{#each special}} ({{mod}} {{label}}){{/each}}
{{/each}}
{{/with}}
attributes:
  str: {{system.abilities.str.mod}}
  dex: {{system.abilities.dex.mod}}
  con: {{system.abilities.con.mod}}
  int: {{system.abilities.int.mod}}
  wis: {{system.abilities.wis.mod}}
  cha: {{system.abilities.cha.mod}}
{{#with (me-getSpeeds system.movement.speeds) as |speeds|}}
speed: {{#each speeds}}{{{this}}}{{ifThen @last "" ", "}}{{/each}}
{{/with}}

ac: {{system.attributes.ac.value}}
{{#if system.attributes.ac.details}}
acNote: {{system.attributes.ac.details}}
{{/if}}
saves:
  - fort: {{system.saves.fortitude.value}}
  - ref: {{system.saves.reflex.value}}
  - will: {{system.saves.will.value}}
  {{#if system.attributes.allSaves.value}}
  - note: {{system.attributes.allSaves.value}}
{{/if}}
hp: {{system.attributes.hp.value}}
{{#if system.attributes.hp.details}}
hpNote: "{{system.attributes.hp.details}}"
{{/if}}
{{#if system.attributes.hardness.value}}
hardness: {{system.attributes.hardness.value}}
{{/if}}
{{#if system.attributes.immunities}}
immunities: "{{#each system.attributes.immunities}}{{label}}{{ifThen @last "" ", "}}{{/each}}"
{{/if}}
{{#if system.attributes.weaknesses}}
weaknesses: "{{#each system.attributes.weaknesses}}{{label}}{{ifThen @last "" ", "}}{{/each}}"
{{/if}}
{{#if system.attributes.resistances}}
resistances: "{{#each system.attributes.resistances}}{{label}}{{ifThen @last "" ", "}}{{/each}}"
{{/if}}

{{#with (me-equipmentList items) as |equipment|}}
items: >
  {{#each equipment}}{{{this}}}{{ifThen @last "" ", "}}{{/each}}
{{/with}}

{{#*inline "abilitiesPartial"}}
{{#if abilities}}
abilities_{{pos}}:
{{#each abilities}}
  - name: "{{#if flags.core.sourceId}}[[{{flags.core.sourceId}}|{{{name}}}]]{{else if _stats.compendiumSource}}[[{{_stats.compendiumSource}}|{{{name}}}]]{{else}}{{{name}}}{{/if}}"
    desc: "{{#with (me-actionIcon system.actions.value fallback=system.actionType.value)}}{{this}} {{/with}}{{#with system.traits.value as |traits|}}({{#each traits}}{{{this}}}{{ifThen @last "" ", "}}{{/each}}) {{/with}}{{{me-HTMLtoYAML system.description.value this}}}"
{{/each}}{{/if~}}
{{/inline}}
{{> abilitiesPartial pos="top" abilities=(me-getAbilities items "top" this)}}
{{> abilitiesPartial pos="mid" abilities=(me-getAbilities items "mid" this)}}
{{> abilitiesPartial pos="bot" abilities=(me-getAbilities items "bot" this)}}

{{#with (me-getItemsByType items "melee") as |attacks|}}
attacks:
{{#each attacks}}
  - name: ___{{#if isRanged}}Ranged{{else}}Melee{{/if}}___ {{{me-actionIcon "1"}}} {{name}}
    bonus: {{system.bonus.value}}
    desc: "({{#each system.traits.value}}{{lower (me-trait this)}}{{ifThen @last "" ", "}}{{/each}})"
    damage: "{{#each system.damageRolls}}{{{damage}}} {{damageType}}{{#if ../system.attackEffects.value}} plus *{{me-attack-effect ../system.attackEffects.value}}*{{/if}}{{ifThen @last "" " "}}{{/each}}"
{{/each}}{{/with}}

{{#if (me-getItemsByType items "spellcastingEntry")}}
spellcasting:
{{else}}
{{#if (me-getRituals items)}}
spellcasting:
{{/if}}
{{/if}}
{{#each (me-getItemsByType items "spellcastingEntry") as |spellcasting|}}
  - name: "{{spellcasting.name}}"
    desc: >
      {{#if (eq spellcasting.system.prepared.value 'focus')}}{{@root.system.resources.focus.value}} Focus Point{{#if (gt @root.system.resources.focus.value 1)}}s{{/if}}, {{/if}}DC {{spellcasting.system.spelldc.dc}}, attack {{numberFormat spellcasting.system.spelldc.value sign=true}};
      {{#each (me-spellLevels @root.items spellcasting.id 'spells') as |level|}}
      __{{ordinal level}}__ {{me-getSpellSlotCount spellcasting level}} {{#each (me-getSpellList @root.items spellcasting.id level 'spells')}}_{{{this}}}_{{ifThen @last '' ', '}}{{/each}}{{ifThen @last '' '; '}}
      {{/each}}
      {{#with (me-spellLevels @root.items spellcasting.id 'cantrips') as |cantripLevels|}}
      __Cantrips__ {{#each cantripLevels as |level|}} __({{ordinal level}})__ {{#each (me-getSpellList @root.items spellcasting.id level 'cantrips')}}_{{{this}}}_{{#if system.location.uses.value}} (x{{system.location.uses.value}}){{/if}}{{ifThen @last '' ', '}}{{/each}}{{/each}}
      {{/with}}
      {{#with (me-spellLevels @root.items spellcasting.id 'constant') as |constantLevels|}}
      __Constant__ {{#each constantLevels as |level|}} __({{ordinal level}})__ {{#each (me-getSpellList @root.items spellcasting.id level 'constant')}}_{{{this}}}_{{#if system.location.uses.value}} (x{{system.location.uses.value}}){{/if}}{{ifThen @last '' ', '}}{{/each}}{{/each}}
      {{/with}}
{{/each}}{{~#with (me-getRituals items) as |rituals|}}
  - name: "Rituals"
    desc: "{{#each rituals}}_{{{this}}}_{{ifThen @last '' ', '}}{{/each}}"
{{/with}}
```

{{#if this.include_initiative}}
```encounter-table
name: {{{name}}}
creatures:
  - 1: {{{name}}}
```

{{/if}}{{#if system.details.blurb}}
{{{me-HTMLtoMarkdown system.details.blurb system}}}{{/if}}

{{#if system.details.publicNotes}}
{{{me-HTMLtoMarkdown system.details.publicNotes system}}}{{/if}}
